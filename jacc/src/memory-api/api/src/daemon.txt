┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                            RUNTIME ARCHITECTURE                                          │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│   USER runs CLI command                                                                  │
│            │                                                                             │
│            ▼                                                                             │
│   ┌────────────────────────────────────────────────────────────────────────────────┐    │
│   │                        daemon.py (Process Management)                          │    │
│   │                                                                                │    │
│   │   • daemonize() → Fork into background                                         │    │
│   │   • DaemonLock → Prevent multiple instances                                    │    │
│   │   • IdleTimeoutMiddleware → Auto-exit after inactivity                        │    │
│   └────────────────────────────────────────────────────────────────────────────────┘    │
│            │                                                                             │
│            │ starts                                                                      │
│            ▼                                                                             │
│   ┌────────────────────────────────────────────────────────────────────────────────┐    │
│   │                        Uvicorn HTTP Server                                     │    │
│   │                              (ASGI)                                            │    │
│   └────────────────────────────────────────────────────────────────────────────────┘    │
│            │                                                                             │
│            │ hosts                                                                       │
│            ▼                                                                             │
│   ┌────────────────────────────────────────────────────────────────────────────────┐    │
│   │                        MemoryEngine                                            │    │
│   │                                                                                │    │
│   │   • retain_async()                                                             │    │
│   │   • recall_async()                                                             │    │
│   │   • reflect_async()                                                            │    │
│   │                                                                                │    │
│   │   ┌────────────────────────────────────────────────────────────────────────┐   │    │
│   │   │              task_backend (AsyncIOQueueBackend)                        │   │    │
│   │   │                                                                        │   │    │
│   │   │   _worker() runs as background asyncio Task                            │   │    │
│   │   │         │                                                              │   │    │
│   │   │         └──► Processes: access_count_update, form_opinion, etc.       │   │    │
│   │   └────────────────────────────────────────────────────────────────────────┘   │    │
│   └────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                          │
│   HIERARCHY:                                                                             │
│   ────────────                                                                           │
│   daemon.py manages the ENTIRE PROCESS (start/stop/idle timeout)                        │
│   task_backend runs INSIDE the process as an asyncio background task                    │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘